-month=Date.today.month
-year=Date.today.year

-startweekday = Date.civil(year,month,1).strftime("%u").to_i
-startweekday = 0 if startweekday.to_i > 6
-lastday = Date.civil(year,month,-1).day.to_i
-d = -1

.calendar_wrap

  %h1
    Events in
    %span.red_color
      =Date.civil(year,month,1).strftime("%B").upcase

  .calendar

    %ul.names
      -7.times do |day|
        %li
          -weekday = Date::DAYNAMES[day]
          =weekday[0..2].capitalize

    -5.times do |week|
      %ul
        -7.times do |day|
          %li
            -if startweekday == day
              -startweekday = -1
              -d = 0
            -if d >= 0 && d < lastday
              -d += 1
              - unless (lessons = lessons_today?(year, month, d)).empty?
                %a.event{:href => lessons.first.url, :title => lessons.first.title}
                  =d
              -else
                =d

